<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>De Vraagbouwer — Vraagstelling Leren</title>
  <link rel="stylesheet" href="../../styles.css">
  <style>
    /* === Innovatieradar Stylebook tokens === */
    :root {
      --primary:        #1e3a5f;
      --primary-light:  #2d5a8e;
      --primary-50:     #f0f5fa;
      --primary-100:    #dae5f2;
      --border:         #e2e8f0;
      --surface:        #f8fafc;
      --success:        #16a34a;
      --success-light:  #dcfce7;
      --warning:        #d97706;
      --warning-light:  #fef3c7;
      --danger:         #dc2626;
      --danger-light:   #fee2e2;
      --text-secondary: #64748b;
      --text-dark:      #1e293b;
    }

    /* Mode toggle */

    /* Three-column input grid */
    .input-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }
    @media (max-width: 768px) {
      .input-grid { grid-template-columns: 1fr; }
    }

    .input-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .input-card label {
      display: block;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      color: var(--text-dark);
    }
    .input-card .sublabel {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 0.6rem;
    }

    /* Assembled question */
    .assembled-section { margin-top: 1.5rem; }
    .assembled-section h3 {
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .assembled-placeholder {
      color: #94a3b8;
      font-style: italic;
    }
    .copy-btn { margin-top: 0.75rem; }

    /* Stars */
    .stars-display {
      font-size: 1.4rem;
      letter-spacing: 2px;
    }
    .star-filled { color: #f59e0b; }
    .star-empty  { color: var(--border); }
    .niveau-label {
      font-weight: 600;
      margin-left: 0.5rem;
      font-size: 0.9rem;
    }

    /* Signal pills */
    .signal-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin: 0.5rem 0;
    }
    .signal-legend {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }


    /* Eindig/oneindig toggle section */
    .variant-toggle-btn { margin-top: 1.5rem; }
    .variant-section { margin-top: 1rem; }
    .variant-col h4 { margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-dark); }
    .variant-explanation {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }
    .variant-note {
      margin-top: 1rem;
      font-style: italic;
      color: var(--text-secondary);
      text-align: center;
      font-size: 0.9rem;
    }

    /* Tips */
    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      margin-top: 0.75rem;
    }
    .tip-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.25rem;
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--text-dark);
    }

    /* Feedback panel sections */
    .feedback-section { margin-bottom: 1.25rem; }
    .feedback-section h4 {
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <a class="navbar-brand" href="../../index.html">Workshop Onderzoekend Vermogen</a>
    <ul class="navbar-links">
      <li><a class="nav-link" href="../../index.html">&larr; Workshop</a></li>
      <li><a class="nav-link" href="../index.html">Overzicht</a></li>
      <li><a class="nav-link" href="../rangschik/">Rangschik de Vraag</a></li>
      <li><a class="nav-link" href="../vraagkliniek/">De Vraagkliniek</a></li>
    </ul>
  </nav>

  <!-- Page header -->
  <header class="page-header">
    <h1>De Vraagbouwer</h1>
    <p>Bouw je eigen ontwerpende onderzoeksvraag op uit drie bouwstenen en ontvang live feedback.</p>
  </header>

  <div class="container">

    <!-- Three input fields -->
    <div class="input-grid">

      <div class="input-card">
        <label>Actor (wie?)</label>
        <div class="sublabel">De organisatie, afdeling of rol die maatregelen neemt</div>
        <textarea id="fieldActor" class="input-field" rows="3"
                  placeholder="bijv. de HR-afdeling van organisatie X"></textarea>
      </div>

      <div class="input-card">
        <label>Doel + Werkwoord (wat?)</label>
        <div class="sublabel">Gebruik een ontwerpend werkwoord: inrichten, ontwikkelen, opzetten, implementeren</div>
        <textarea id="fieldDoel" class="input-field" rows="3"
                  placeholder="bijv. de employee journey in te richten"></textarea>
      </div>

      <div class="input-card">
        <label>Waardecreatie (waarom? — zodat...)</label>
        <div class="sublabel">Oneindig: gebruik woorden als 'blijvend', 'continu', 'vermogen', 'adaptief'</div>
        <textarea id="fieldWaarde" class="input-field" rows="3"
                  placeholder="bijv. de organisatie een adaptieve capaciteit opbouwt voor blijvende medewerkerbetrokkenheid"></textarea>
      </div>

    </div>

    <!-- Assembled question -->
    <div class="assembled-section">
      <h3>Jouw onderzoeksvraag:</h3>
      <div class="question-box" id="assembledBox"></div>
      <button class="btn btn-primary copy-btn" id="copyBtn" onclick="kopieerVraag()">Kopieer vraag</button>
    </div>

    <!-- Live feedback panel -->
    <div class="feedback-panel mt-3">

      <div class="feedback-section">
        <h4>Kwaliteitsscore</h4>
        <div>
          <span class="stars-display" id="starsDisplay"></span>
          <span class="niveau-label" id="niveauLabel"></span>
        </div>
      </div>

      <div class="feedback-section">
        <h4>Signaalwoorden</h4>
        <div class="signal-pills" id="signalPills"></div>
        <div class="signal-legend">Rood = eindig denken (eindpunt/KPI) | Groen = oneindig denken (blijvend vermogen)</div>
      </div>


    </div>

    <!-- Eindig / Oneindig variant toggle -->
    <button class="btn btn-secondary variant-toggle-btn" id="variantToggle" onclick="toggleVarianten()">Toon eindig/oneindig varianten</button>

    <div class="variant-section hidden" id="variantSection">
      <div class="comparison-grid">
        <div class="card variant-col">
          <h4>Eindige variant <span class="star-filled">&#9733;&#9733;&#9733;</span><span class="star-empty">&#9734;&#9734;</span></h4>
          <span class="badge badge-orange">Goed (eindig)</span>
          <div class="question-box mt-1" id="variantEindig"></div>
          <p class="variant-explanation">Eindig: meetbaar eindpunt, geschikt als de organisatie opereert in een stabiele context.</p>
        </div>
        <div class="card variant-col">
          <h4>Oneindige variant <span class="star-filled">&#9733;&#9733;&#9733;&#9733;&#9733;</span></h4>
          <span class="badge badge-green">Excellent (oneindig)</span>
          <div class="question-box mt-1" id="variantOneindig"></div>
          <p class="variant-explanation">Oneindig: blijvend vermogen, geschikt voor een VUCA-context met emergente strategie.</p>
        </div>
      </div>
      <p class="variant-note">Welke variant past bij jouw opdrachtgever? Beargumenteer je keuze.</p>
    </div>

    <!-- Tips -->
    <div class="mt-4 mb-4">
      <h3>Tips voor een sterke vraag</h3>
      <div class="tips-grid">
        <div class="tip-card"><strong>Actor:</strong> Kies een actor met mandaat. Niet 'het bedrijf', maar 'de HR-afdeling' of 'de directie'.</div>
        <div class="tip-card"><strong>Werkwoord:</strong> Gebruik 'inrichten', 'ontwikkelen' of 'opzetten' — werkwoorden die om maatregelen vragen.</div>
        <div class="tip-card"><strong>Waardecreatie:</strong> Oneindig denken? Gebruik 'blijvend', 'adaptief', 'continu vermogen' in plaats van een KPI.</div>
      </div>
    </div>

    <div class="card mt-3 mb-4" style="border-left: 4px solid var(--primary); background: var(--primary-50);">
      <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem; color: var(--primary);">&#x1F4A1; Wat moet je hiervan onthouden?</h4>
      <p style="margin: 0; color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem;">
        Je kunt nu zelf een ontwerpende onderzoeksvraag formuleren. Gebruik deze vaardigheid in je
        Plan van Aanpak: kies een actor met mandaat, een ontwerpend werkwoord, en een waardecreatie
        die stuurt op blijvend vermogen. Dat is het verschil tussen een vraag die afvinkt en een
        vraag die richting geeft.
      </p>
    </div>

  </div>

  <script src="../../data.js"></script>
  <script>
    // ===== Elements =====
    const fieldActor = document.getElementById('fieldActor');
    const fieldDoel = document.getElementById('fieldDoel');
    const fieldWaarde = document.getElementById('fieldWaarde');
    const assembledBox = document.getElementById('assembledBox');
    const starsDisplay = document.getElementById('starsDisplay');
    const niveauLabel = document.getElementById('niveauLabel');
    const signalPills = document.getElementById('signalPills');
const variantSection = document.getElementById('variantSection');
    const variantEindig = document.getElementById('variantEindig');
    const variantOneindig = document.getElementById('variantOneindig');

    const EINDIG_WAARDE = 'medewerkers meer tevreden zijn en het verlooppercentage daalt';

    const NIVEAU_LABELS = {
      0: 'Onvoldoende',
      1: 'Zwak',
      2: 'Goed (eindig)',
      3: 'Sterk',
      4: 'Excellent (oneindig)'
    };

    // ===== Debounce =====
    function debounce(fn, ms) {
      let timer;
      return function() {
        clearTimeout(timer);
        timer = setTimeout(fn, ms);
      };
    }

    const debouncedUpdate = debounce(updateAlles, 300);
    fieldActor.addEventListener('input', debouncedUpdate);
    fieldDoel.addEventListener('input', debouncedUpdate);
    fieldWaarde.addEventListener('input', debouncedUpdate);

    // ===== Main update =====
    function updateAlles() {
      updateSamengesteldeVraag();
      updateSterren();
      updateSignaalwoorden();
      updateVarianten();
    }

    // ===== Assembled question =====
    function lowercaseFirst(s) {
      if (!s) return s;
      return s.charAt(0).toLowerCase() + s.slice(1);
    }

    function getVraagText() {
      var a = lowercaseFirst(fieldActor.value.trim());
      var d = lowercaseFirst(fieldDoel.value.trim());
      var w = lowercaseFirst(fieldWaarde.value.trim());
      return 'Welke maatregelen moet '
        + (a || '[actor]')
        + ' nemen om '
        + (d || '[doel + werkwoord]')
        + ', zodat '
        + (w || '[waardecreatie]')
        + '?';
    }

    function updateSamengesteldeVraag() {
      var a = lowercaseFirst(fieldActor.value.trim());
      var d = lowercaseFirst(fieldDoel.value.trim());
      var w = lowercaseFirst(fieldWaarde.value.trim());

      function part(val, placeholder) {
        if (val) return '<span>' + escapeHtml(val) + '</span>';
        return '<span class="assembled-placeholder">' + placeholder + '</span>';
      }

      assembledBox.innerHTML =
        'Welke maatregelen moet '
        + part(a, '[actor]')
        + ' nemen om '
        + part(d, '[doel + werkwoord]')
        + ', zodat '
        + part(w, '[waardecreatie]')
        + '?';
    }

    function escapeHtml(t) {
      var d = document.createElement('div');
      d.textContent = t;
      return d.innerHTML;
    }

    // ===== Stars =====
    function fieldsFilledCount() {
      var c = 0;
      if (fieldActor.value.trim()) c++;
      if (fieldDoel.value.trim()) c++;
      if (fieldWaarde.value.trim()) c++;
      return c;
    }

    function detectWords(text, list) {
      var lower = text.toLowerCase();
      var found = [];
      for (var i = 0; i < list.length; i++) {
        if (lower.indexOf(list[i].toLowerCase()) !== -1) {
          found.push(list[i]);
        }
      }
      return found;
    }

function updateSterren() {
      var filled = fieldsFilledCount();
      var assembled = getVraagText();
      var eindig = detectWords(assembled, SIGNAALWOORDEN_EINDIG);
      var oneindig = detectWords(fieldWaarde.value, SIGNAALWOORDEN_ONEINDIG);

      var stars = 0;
      if (filled < 2) {
        stars = 0;
      } else if (filled === 2) {
        stars = 1;
      } else if (filled === 3 && oneindig.length > 0) {
        stars = 4;
      } else if (filled === 3 && eindig.length === 0) {
        stars = 3;
      } else if (filled === 3 && eindig.length > 0) {
        stars = 2;
      } else {
        stars = 0;
      }

      var html = '';
      for (var i = 1; i <= 4; i++) {
        html += i <= stars
          ? '<span class="star-filled">&#9733;</span>'
          : '<span class="star-empty">&#9734;</span>';
      }
      starsDisplay.innerHTML = html;
      niveauLabel.textContent = NIVEAU_LABELS[stars] || '';
    }

    // ===== Signal words =====
    function updateSignaalwoorden() {
      var assembled = getVraagText();
      var eindig = detectWords(assembled, SIGNAALWOORDEN_EINDIG);
      var oneindig = detectWords(assembled, SIGNAALWOORDEN_ONEINDIG);

      if (eindig.length === 0 && oneindig.length === 0) {
        signalPills.innerHTML = '<span class="text-muted">Nog geen signaalwoorden gedetecteerd</span>';
        return;
      }

      var html = '';
      for (var i = 0; i < eindig.length; i++) {
        html += '<span class="signal-word signal-eindig">' + escapeHtml(eindig[i]) + '</span>';
      }
      for (var j = 0; j < oneindig.length; j++) {
        html += '<span class="signal-word signal-oneindig">' + escapeHtml(oneindig[j]) + '</span>';
      }
      signalPills.innerHTML = html;
    }

// ===== Variants =====
    function updateVarianten() {
      var a = fieldActor.value.trim() || '[actor]';
      var d = fieldDoel.value.trim() || '[doel + werkwoord]';

      variantEindig.textContent = 'Welke maatregelen moet ' + a + ' nemen om ' + d + ', zodat ' + EINDIG_WAARDE + '?';
      var w = fieldWaarde.value.trim() || '[waardecreatie]';
      variantOneindig.textContent = 'Welke maatregelen moet ' + a + ' nemen om ' + d + ', zodat ' + w + '?';
    }

    function toggleVarianten() {
      variantSection.classList.toggle('hidden');
      var btn = document.getElementById('variantToggle');
      if (variantSection.classList.contains('hidden')) {
        btn.textContent = 'Toon eindig/oneindig varianten';
      } else {
        btn.textContent = 'Verberg eindig/oneindig varianten';
      }
    }

    // ===== Copy =====
    function kopieerVraag() {
      var text = getVraagText();
      navigator.clipboard.writeText(text).then(function() {
        var btn = document.getElementById('copyBtn');
        btn.textContent = 'Gekopieerd!';
        setTimeout(function() {
          btn.textContent = 'Kopieer vraag';
        }, 2000);
      });
    }

    // ===== Init =====
    updateAlles();
  </script>

</body>
</html>
